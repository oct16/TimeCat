const t=new Set;const e=new class{constructor(){this.nodeId=1,this.nodeMap=new Map,this.idMap=new WeakMap,this.createNodeId=()=>this.nodeId++}getNode(t){return this.nodeMap.get(t)}addNode(t,e=this.createNodeId()){return this.idMap.set(t,e),this.nodeMap.set(e,t),e}removeNode(t){this.nodeMap.delete(t),this.idMap.delete(this.getNode(t))}getNodeId(t){return this.idMap.get(t)}updateNode(t,e){this.idMap.set(e,t),this.nodeMap.set(t,e)}};class n{constructor(t,e,n,r){this.DBName=t,this.version=e,this.storeName=n;const o=window.indexedDB.open(t,e);o.onerror=t=>{console.error("open indexedDB on error")},o.onsuccess=t=>{this.db=o.result,r(this.db)},o.onupgradeneeded=t=>{const e=t.target.result;if(!e.objectStoreNames.contains(n)){const t=e.createObjectStore(n,{autoIncrement:!0,keyPath:"id"});t.createIndex("type","type",{unique:!1}),t.createIndex("data","data",{unique:!1}),t.createIndex("time","time",{unique:!1})}}}add(t){this.db.transaction([`${this.storeName}`],"readwrite").objectStore(`${this.storeName}`).add(t).onerror=t=>{throw new Error("write indexedDB on error")}}clear(){this.db.transaction([`${this.storeName}`],"readwrite").objectStore(`${this.storeName}`).clear()}async readAll(){const t=this.db.transaction([`${this.storeName}`],"readwrite").objectStore(`${this.storeName}`);return new Promise(e=>{t.getAll().onsuccess=t=>{const n=t.target.result;e(n)}})}async getData(){const t=await this.readAll(),[e,n,...r]=t,[{width:o,height:i},{vNode:a}]=[e.data,n.data];return{width:o,height:i,vNode:a,data:r}}}const r=new Promise(t=>{const e=new n("wr_db",1,"wr_data",()=>{t(e)})});let o={speed:null};var i;!function(t){t.SPEED="SPEED"}(i||(i={}));const a={frame:0,length:0,curTime:0,startTime:0,endTime:0};var s;function c(t,e){return t===e||t!=t&&e!=e}function d(t,e){for(var n=t.length;n--;)if(c(t[n][0],e))return n;return-1}!function(t){t.FORWARD="FORWARD",t.BACKWARD="BACKWARD",t.INFO="INFO"}(s||(s={}));var u=Array.prototype.splice;function l(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}l.prototype.clear=function(){this.__data__=[],this.size=0},l.prototype.delete=function(t){var e=this.__data__,n=d(e,t);return!(n<0)&&(n==e.length-1?e.pop():u.call(e,n,1),--this.size,!0)},l.prototype.get=function(t){var e=this.__data__,n=d(e,t);return n<0?void 0:e[n][1]},l.prototype.has=function(t){return d(this.__data__,t)>-1},l.prototype.set=function(t,e){var n=this.__data__,r=d(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};var h="object"==typeof global&&global&&global.Object===Object&&global,p="object"==typeof self&&self&&self.Object===Object&&self,f=h||p||Function("return this")(),b=f.Symbol,y=Object.prototype,m=y.hasOwnProperty,g=y.toString,v=b?b.toStringTag:void 0;var w=Object.prototype.toString;var _=b?b.toStringTag:void 0;function x(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":_&&_ in Object(t)?function(t){var e=m.call(t,v),n=t[v];try{t[v]=void 0;var r=!0}catch(t){}var o=g.call(t);return r&&(e?t[v]=n:delete t[v]),o}(t):function(t){return w.call(t)}(t)}function E(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function O(t){if(!E(t))return!1;var e=x(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}var j,A=f["__core-js_shared__"],N=(j=/[^.]+$/.exec(A&&A.keys&&A.keys.IE_PROTO||""))?"Symbol(src)_1."+j:"";var T=Function.prototype.toString;function D(t){if(null!=t){try{return T.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var S=/^\[object .+?Constructor\]$/,L=Function.prototype,I=Object.prototype,M=L.toString,C=I.hasOwnProperty,P=RegExp("^"+M.call(C).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function k(t){return!(!E(t)||(e=t,N&&N in e))&&(O(t)?P:S).test(D(t));var e}function B(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return k(n)?n:void 0}var U=B(f,"Map"),F=B(Object,"create");var R=Object.prototype.hasOwnProperty;var z=Object.prototype.hasOwnProperty;function W(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function V(t,e){var n,r,o=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?o["string"==typeof e?"string":"hash"]:o.map}function q(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}W.prototype.clear=function(){this.__data__=F?F(null):{},this.size=0},W.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},W.prototype.get=function(t){var e=this.__data__;if(F){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return R.call(e,t)?e[t]:void 0},W.prototype.has=function(t){var e=this.__data__;return F?void 0!==e[t]:z.call(e,t)},W.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=F&&void 0===e?"__lodash_hash_undefined__":e,this},q.prototype.clear=function(){this.size=0,this.__data__={hash:new W,map:new(U||l),string:new W}},q.prototype.delete=function(t){var e=V(this,t).delete(t);return this.size-=e?1:0,e},q.prototype.get=function(t){return V(this,t).get(t)},q.prototype.has=function(t){return V(this,t).has(t)},q.prototype.set=function(t,e){var n=V(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};function $(t){var e=this.__data__=new l(t);this.size=e.size}$.prototype.clear=function(){this.__data__=new l,this.size=0},$.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},$.prototype.get=function(t){return this.__data__.get(t)},$.prototype.has=function(t){return this.__data__.has(t)},$.prototype.set=function(t,e){var n=this.__data__;if(n instanceof l){var r=n.__data__;if(!U||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new q(r)}return n.set(t,e),this.size=n.size,this};function G(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new q;++e<n;)this.add(t[e])}function H(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}G.prototype.add=G.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},G.prototype.has=function(t){return this.__data__.has(t)};function K(t,e,n,r,o,i){var a=1&n,s=t.length,c=e.length;if(s!=c&&!(a&&c>s))return!1;var d=i.get(t);if(d&&i.get(e))return d==e;var u=-1,l=!0,h=2&n?new G:void 0;for(i.set(t,e),i.set(e,t);++u<s;){var p=t[u],f=e[u];if(r)var b=a?r(f,p,u,e,t,i):r(p,f,u,t,e,i);if(void 0!==b){if(b)continue;l=!1;break}if(h){if(!H(e,(function(t,e){if(a=e,!h.has(a)&&(p===t||o(p,t,n,r,i)))return h.push(e);var a}))){l=!1;break}}else if(p!==f&&!o(p,f,n,r,i)){l=!1;break}}return i.delete(t),i.delete(e),l}var Q=f.Uint8Array;function X(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function Y(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}var J=b?b.prototype:void 0,Z=J?J.valueOf:void 0;var tt=Array.isArray;var et=Object.prototype.propertyIsEnumerable,nt=Object.getOwnPropertySymbols,rt=nt?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var n=-1,r=null==t?0:t.length,o=0,i=[];++n<r;){var a=t[n];e(a,n,t)&&(i[o++]=a)}return i}(nt(t),(function(e){return et.call(t,e)})))}:function(){return[]};function ot(t){return null!=t&&"object"==typeof t}function it(t){return ot(t)&&"[object Arguments]"==x(t)}var at=Object.prototype,st=at.hasOwnProperty,ct=at.propertyIsEnumerable,dt=it(function(){return arguments}())?it:function(t){return ot(t)&&st.call(t,"callee")&&!ct.call(t,"callee")};var ut="object"==typeof exports&&exports&&!exports.nodeType&&exports,lt=ut&&"object"==typeof module&&module&&!module.nodeType&&module,ht=lt&&lt.exports===ut?f.Buffer:void 0,pt=(ht?ht.isBuffer:void 0)||function(){return!1},ft=/^(?:0|[1-9]\d*)$/;function bt(t,e){var n=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&ft.test(t))&&t>-1&&t%1==0&&t<e}function yt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}var mt={};mt["[object Float32Array]"]=mt["[object Float64Array]"]=mt["[object Int8Array]"]=mt["[object Int16Array]"]=mt["[object Int32Array]"]=mt["[object Uint8Array]"]=mt["[object Uint8ClampedArray]"]=mt["[object Uint16Array]"]=mt["[object Uint32Array]"]=!0,mt["[object Arguments]"]=mt["[object Array]"]=mt["[object ArrayBuffer]"]=mt["[object Boolean]"]=mt["[object DataView]"]=mt["[object Date]"]=mt["[object Error]"]=mt["[object Function]"]=mt["[object Map]"]=mt["[object Number]"]=mt["[object Object]"]=mt["[object RegExp]"]=mt["[object Set]"]=mt["[object String]"]=mt["[object WeakMap]"]=!1;var gt,vt="object"==typeof exports&&exports&&!exports.nodeType&&exports,wt=vt&&"object"==typeof module&&module&&!module.nodeType&&module,_t=wt&&wt.exports===vt&&h.process,xt=function(){try{var t=wt&&wt.require&&wt.require("util").types;return t||_t&&_t.binding&&_t.binding("util")}catch(t){}}(),Et=xt&&xt.isTypedArray,Ot=Et?(gt=Et,function(t){return gt(t)}):function(t){return ot(t)&&yt(t.length)&&!!mt[x(t)]},jt=Object.prototype.hasOwnProperty;function At(t,e){var n=tt(t),r=!n&&dt(t),o=!n&&!r&&pt(t),i=!n&&!r&&!o&&Ot(t),a=n||r||o||i,s=a?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],c=s.length;for(var d in t)!e&&!jt.call(t,d)||a&&("length"==d||o&&("offset"==d||"parent"==d)||i&&("buffer"==d||"byteLength"==d||"byteOffset"==d)||bt(d,c))||s.push(d);return s}var Nt=Object.prototype;var Tt=function(t,e){return function(n){return t(e(n))}}(Object.keys,Object),Dt=Object.prototype.hasOwnProperty;function St(t){if(n=(e=t)&&e.constructor,e!==("function"==typeof n&&n.prototype||Nt))return Tt(t);var e,n,r=[];for(var o in Object(t))Dt.call(t,o)&&"constructor"!=o&&r.push(o);return r}function Lt(t){return null!=(e=t)&&yt(e.length)&&!O(e)?At(t):St(t);var e}function It(t){return function(t,e,n){var r=e(t);return tt(t)?r:function(t,e){for(var n=-1,r=e.length,o=t.length;++n<r;)t[o+n]=e[n];return t}(r,n(t))}(t,Lt,rt)}var Mt=Object.prototype.hasOwnProperty;var Ct=B(f,"DataView"),Pt=B(f,"Promise"),kt=B(f,"Set"),Bt=B(f,"WeakMap"),Ut=D(Ct),Ft=D(U),Rt=D(Pt),zt=D(kt),Wt=D(Bt),Vt=x;(Ct&&"[object DataView]"!=Vt(new Ct(new ArrayBuffer(1)))||U&&"[object Map]"!=Vt(new U)||Pt&&"[object Promise]"!=Vt(Pt.resolve())||kt&&"[object Set]"!=Vt(new kt)||Bt&&"[object WeakMap]"!=Vt(new Bt))&&(Vt=function(t){var e=x(t),n="[object Object]"==e?t.constructor:void 0,r=n?D(n):"";if(r)switch(r){case Ut:return"[object DataView]";case Ft:return"[object Map]";case Rt:return"[object Promise]";case zt:return"[object Set]";case Wt:return"[object WeakMap]"}return e});var qt=Vt,$t=Object.prototype.hasOwnProperty;function Gt(t,e,n,r,o,i){var a=tt(t),s=tt(e),d=a?"[object Array]":qt(t),u=s?"[object Array]":qt(e),l="[object Object]"==(d="[object Arguments]"==d?"[object Object]":d),h="[object Object]"==(u="[object Arguments]"==u?"[object Object]":u),p=d==u;if(p&&pt(t)){if(!pt(e))return!1;a=!0,l=!1}if(p&&!l)return i||(i=new $),a||Ot(t)?K(t,e,n,r,o,i):function(t,e,n,r,o,i,a){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!i(new Q(t),new Q(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return c(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var s=X;case"[object Set]":var d=1&r;if(s||(s=Y),t.size!=e.size&&!d)return!1;var u=a.get(t);if(u)return u==e;r|=2,a.set(t,e);var l=K(s(t),s(e),r,o,i,a);return a.delete(t),l;case"[object Symbol]":if(Z)return Z.call(t)==Z.call(e)}return!1}(t,e,d,n,r,o,i);if(!(1&n)){var f=l&&$t.call(t,"__wrapped__"),b=h&&$t.call(e,"__wrapped__");if(f||b){var y=f?t.value():t,m=b?e.value():e;return i||(i=new $),o(y,m,n,r,i)}}return!!p&&(i||(i=new $),function(t,e,n,r,o,i){var a=1&n,s=It(t),c=s.length;if(c!=It(e).length&&!a)return!1;for(var d=c;d--;){var u=s[d];if(!(a?u in e:Mt.call(e,u)))return!1}var l=i.get(t);if(l&&i.get(e))return l==e;var h=!0;i.set(t,e),i.set(e,t);for(var p=a;++d<c;){var f=t[u=s[d]],b=e[u];if(r)var y=a?r(b,f,u,e,t,i):r(f,b,u,t,e,i);if(!(void 0===y?f===b||o(f,b,n,r,i):y)){h=!1;break}p||(p="constructor"==u)}if(h&&!p){var m=t.constructor,g=e.constructor;m!=g&&"constructor"in t&&"constructor"in e&&!("function"==typeof m&&m instanceof m&&"function"==typeof g&&g instanceof g)&&(h=!1)}return i.delete(t),i.delete(e),h}(t,e,n,r,o,i))}function Ht(t,e,n,r,o){return t===e||(null==t||null==e||!ot(t)&&!ot(e)?t!=t&&e!=e:Gt(t,e,n,r,Ht,o))}const Kt=function(t,e={}){let n=e;const r={all:[]};return{subscribe:function(...t){let e,n="all";"string"==typeof t[0]?(n=t[0],e=t[1]):e=t[0],r[n]||(r[n]=[]),r[n].push(e)},dispatch:function(e){const o=n;if(n=t(n,e),!e)return void(r.all&&r.all.forEach(t=>t(n)));const a=function(t){const e={player:Object.keys(i),progress:Object.keys(s)};for(let[n,r]of Object.entries(e))if(r.includes(t))return n;return null}(e.type);return a&&r[a]?r[a].forEach(t=>{var e,r;e=n[a],r=o[a],Ht(e,r)||t(n[a])}):void 0},getState:function(){return n}}}(function(t){const e=Object.keys(t);return function(n,r){const o={};for(let i=0;i<e.length;i++){const a=e[i],s=(0,t[a])(n[a],r);o[a]=s}return o}}({player:function(t,e){if(t||(t=o),!e)return t;const{type:n,data:r}=e;switch(n){case i.SPEED:return{...t,...r};default:return t}},progress:function(t,e){if(t||(t=a),!e)return t;const{type:n,data:r}=e;switch(n){case s.FORWARD:return{...t,frame:r.frame,curTime:r.curTime};case s.BACKWARD:return{...t,frame:r.frame};case s.INFO:return{...t,...r};default:return t}}}));function Qt(){return performance.timing.navigationStart+performance.now()}function Xt(t){return t.replace(/<\/script>/g,"<\\/script>")}function Yt(t){return/^\/(?!\/)/.test(t)}function Jt(t){return/^\/\//.test(t)}function Zt(t){return t.replace(/(?<=url\()(\/{1,2}[^'"]*?)(?=\))/g,t=>Yt(t)?location.origin+t:Jt(t)?location.protocol+t:t)}function te(t){if(t.startsWith("data"))return t;return t=t.replace(/^(\/{1,2}.*)/g,t=>Yt(t)?location.origin+t:Jt(t)?location.protocol+t:t),/^http/.test(t)?t:location.origin+"/"+t}const ee=(new DOMParser).parseFromString('<!DOCTYPE html>\n<html lang="en">\n\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <meta http-equiv="Content-Security-Policy-Report-Only" />\n    <title>Web Replay</title>\n</head>\n\n<body>\n</body>\n\n</html>\n',"text/html");async function ne(t={}){var e,n,o,i;await async function(){const t=await(await r).getData(),e=JSON.stringify(t),n=document.createElement("script"),o=`var __ReplayData__ = ${e}`;n.innerText=o,ee.body.insertBefore(n,ee.body.firstChild)}(),await async function(t){const{autoPlay:e,scripts:n}=t,r=n||[];e&&r.push("wr.replay()");await async function(t){if(t)for(let e of t){let t=e;const n=document.createElement("script");if(/:\/\//.test(e)){const n=e;t=await re(n)}n.text=t,ee.body.appendChild(n)}}(r)}(t),e=`Replay-${Date.now()}`,n=ee.documentElement.outerHTML,o=document.createElement("a"),i=new Blob([n],{type:"text/html"}),o.download=e+".html",o.href=URL.createObjectURL(i),o.click(),URL.revokeObjectURL(i)}async function re(t){return await fetch(t).then(t=>t.text()).then(Xt)}const oe=t=>{const e={},n=t.attributes;return t.checked&&(e.checked="true"),n&&n.length?Object.values(n).reduce((t,e)=>{const[n,r]=ie(e);return n&&(t[n]=r),t},e):e},ie=t=>{let{name:e,value:n}=t;return"href"===e||"src"===e?n.startsWith("#/")?[]:[e,te(n)]:"style"===e?[e,Zt(n)]:[e,n]},ae=(t,n)=>{if(t.nodeType===Node.TEXT_NODE)return null;const r=((t,n)=>{const r=t.tagName.toLocaleLowerCase().trim();return{id:e.createNodeId(),attrs:oe(t),tag:r,children:[],extra:{isSVG:n||"svg"===r}}})(t,n),{id:o}=r;return e.addNode(t,o),n=n||r.extra.isSVG,t.childNodes.forEach(t=>{if(t.nodeType===Node.ELEMENT_NODE){const e=ae(t,n);e&&r.children.push(e)}else if(t.nodeType===Node.TEXT_NODE&&t.nodeValue){const e=Zt(t.nodeValue);e&&r.children.push(e)}}),r},se=t=>{const{head:n,body:r}=t;return{id:e.createNodeId(),tag:"html",attrs:{},children:[ae(n),ae(r)],extra:{isSVG:!1}}};function ce(t,e,n){if("style"!==e){if(!/^on\w+$/.test(e)&&/[\w\d]+/.test(e))return t.setAttribute(e,!0===n?"":String(n))}else if(n)if("string"==typeof n)t.style.cssText=n;else if(null!==n&&"object"==typeof n)for(const[e,r]of Object.entries(n))t.style[e]=r}function de(t,n){if(null==t)return null;if("string"==typeof t)return function(t,e){let n;return n=document.createTextNode(t),n}(t);const r=function(t){const{id:n,extra:r}=t,{isSVG:o}=r;let i;const a=(s=t.tag,{script:"noscript"}[s]||s);var s;i=o?document.createElementNS("http://www.w3.org/2000/svg",a):document.createElement(a);return e.updateNode(n,i),i}(t);return(t.children&&t.children.length||r.childNodes&&r.childNodes.length)&&function(t,e){const n=[];t.children.slice().forEach(t=>{let r=n.pop();r=de(t),r&&e.appendChild(r)})}(t,r),function(t,e){const{attrs:n}=t;for(const[t,r]of Object.entries(n))ce(e,t,r)}(t,r),r}var ue,le,he,pe;!function(t){t.WINDOW="WINDOW",t.DOM="DOM",t.MOUSE="MOUSE",t.DOM_UPDATE="DOM_UPDATE",t.FORM_EL_UPDATE="FORM_EL_UPDATE"}(ue||(ue={})),function(t){t.ATTR="ATTR",t.INPUT="INPUT",t.CHANGE="CHANGE",t.FOCUS="FOCUS",t.BLUR="BLUR"}(le||(le={})),function(t){t.MOVE="MOVE",t.CLICK="click"}(he||(he={})),function(t){t.ADD="ADD",t.DELETE="DELETE",t.MOVE="MOVE"}(pe||(pe={}));var fe=function(){return f.Date.now()};var be=/^\s+|\s+$/g,ye=/^[-+]0x[0-9a-f]+$/i,me=/^0b[01]+$/i,ge=/^0o[0-7]+$/i,ve=parseInt;function we(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||ot(t)&&"[object Symbol]"==x(t)}(t))return NaN;if(E(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=E(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(be,"");var n=me.test(t);return n||ge.test(t)?ve(t.slice(2),n?2:8):ye.test(t)?NaN:+t}var _e=Math.max,xe=Math.min;function Ee(t,e,n){var r,o,i,a,s,c,d=0,u=!1,l=!1,h=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function p(e){var n=r,i=o;return r=o=void 0,d=e,a=t.apply(i,n)}function f(t){return d=t,s=setTimeout(y,e),u?p(t):a}function b(t){var n=t-c;return void 0===c||n>=e||n<0||l&&t-d>=i}function y(){var t=fe();if(b(t))return m(t);s=setTimeout(y,function(t){var n=e-(t-c);return l?xe(n,i-(t-d)):n}(t))}function m(t){return s=void 0,h&&r?p(t):(r=o=void 0,a)}function g(){var t=fe(),n=b(t);if(r=arguments,o=this,c=t,n){if(void 0===s)return f(c);if(l)return clearTimeout(s),s=setTimeout(y,e),p(c)}return void 0===s&&(s=setTimeout(y,e)),a}return e=we(e)||0,E(n)&&(u=!!n.leading,i=(l="maxWait"in n)?_e(we(n.maxWait)||0,e):i,h="trailing"in n?!!n.trailing:h),g.cancel=function(){void 0!==s&&clearTimeout(s),d=0,r=c=o=s=void 0},g.flush=function(){return void 0===s?a:m(fe())},g}function Oe(t,e,n){var r=!0,o=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return E(n)&&(r="leading"in n?!!n.leading:r,o="trailing"in n?!!n.trailing:o),Ee(t,e,{leading:r,maxWait:e,trailing:o})}const je={windowObserve:function(e){function n(){e({type:ue.WINDOW,data:{width:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,height:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,scrollTop:window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,scrollLeft:window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,href:window.location.href},time:Qt().toString()})}n();const r=["scroll"];function o(t){const{type:e}=t;"scroll"===e&&n()}r.map(t=>e=>{document.addEventListener(t,e,{once:!1,passive:!0,capture:!0})}).forEach(t=>t(o)),t.add(()=>{r.forEach(t=>{document.removeEventListener(t,o,!0)})})},DOMSnapshot:function(t){t({type:ue.DOM,data:{vNode:se(document)},time:Qt().toString()})},mouseObserve:function(n){!function(){const e=Oe(t=>{n({type:ue.MOUSE,data:{type:he.MOVE,x:t.x,y:t.y},time:Qt().toString()})},100,{trailing:!0});document.addEventListener("mousemove",e),t.add(()=>{document.removeEventListener("mousemove",e)})}(),function(){const r=Oe(t=>{n({type:ue.MOUSE,data:{type:he.CLICK,id:e.getNodeId(t.target),x:t.x,y:t.y},time:Qt().toString()})},250);t.add(()=>{document.removeEventListener("click",r)}),document.addEventListener("click",r)}()},DOMObserve:function(n){const r=new MutationObserver(t=>{const r=[];function o(t,e,n){let r=null;if(e){const n=e.parentNode;r=n.childNodes.length>0?[...n.childNodes].indexOf(t)+1:null}else if(n){const e=n.parentNode;r=e.childNodes.length>0?[...e.childNodes].indexOf(t):null}else r=0;return r}t.forEach(t=>{const{target:n,addedNodes:i,removedNodes:a,type:s,previousSibling:c,nextSibling:d,attributeName:u}=t,l=(h=s,function(t){r.push({mType:h,data:t})});var h;switch(s){case"attributes":if(u){const r=e.getNodeId(n);if(r){const t=n.getAttribute(u);l({nodeId:r,value:t,attr:u})}else console.warn(t,"target not id")}break;case"characterData":const r=n.parentNode;l({parentId:e.getNodeId(r),value:n.nodeValue,pos:r.childNodes.length>0?[...r.childNodes].indexOf(n):null});break;case"childList":i.length&&i.forEach(t=>{let r,i;t.nodeType===Node.TEXT_NODE?(r=t.nodeValue,l({type:pe.ADD,parentId:e.getNodeId(t.parentNode),value:t.textContent,pos:o(t,c,d)})):(i=ae(t),l({type:pe.ADD,parentId:e.getNodeId(n),vNode:i,pos:o(t,c,d)}))}),a.length&&a.forEach(t=>{l({type:pe.DELETE,parentId:e.getNodeId(n),nodeId:e.getNodeId(t)||null})})}}),r.length&&n({type:ue.DOM_UPDATE,data:{mutations:r},time:Qt().toString()})});r.observe(document.body,{attributeOldValue:!0,attributes:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),t.add(()=>{r.disconnect()})},formElementObserve:function(n){!function(n){const r=["input","change","focus","blur"];function o(t){switch(t.type){case"input":case"change":n({type:ue.FORM_EL_UPDATE,data:{type:le.INPUT,id:e.getNodeId(t.target),value:t.target.value},time:Qt().toString()});break;case"focus":n({type:ue.FORM_EL_UPDATE,data:{type:le.FOCUS,id:e.getNodeId(t.target)},time:Qt().toString()});break;case"blur":n({type:ue.FORM_EL_UPDATE,data:{type:le.BLUR,id:e.getNodeId(t.target)},time:Qt().toString()})}}r.map(t=>e=>{document.addEventListener(t,e,{once:!1,passive:!0,capture:!0})}).forEach(t=>t(o)),t.add(()=>{r.forEach(t=>{document.removeEventListener(t,o,!0)})})}(n),function(n){function r(t,r){n({type:ue.FORM_EL_UPDATE,data:{type:le.ATTR,id:e.getNodeId(this),key:t,value:r},time:Qt().toString()})}[[HTMLInputElement.prototype,"value"],[HTMLInputElement.prototype,"checked"],[HTMLSelectElement.prototype,"value"],[HTMLTextAreaElement.prototype,"value"]].map(e=>()=>{const[n,o]=e,i=Object.getOwnPropertyDescriptor(n,o);Object.defineProperty(n,o,{set:function(t){setTimeout(()=>{r.call(this,o,t)}),i&&i.set&&i.set.call(this,t)}}),t.add(()=>{i&&Object.defineProperty(n,o,i)})}).concat([]).forEach(t=>t())}(n)}},Ae={uninstall:()=>{Array.from(t.values()).forEach(t=>t())}},Ne=({emitter:t}={})=>(function(t){[...Object.values(je)].forEach(e=>{e(t)})}(t),Ae);class Te{constructor(t){this.vNode=t.vNode,this.width=t.width,this.height=t.height,this.init()}init(){this.initTemplate(),this.initSandbox()}initSandbox(){this.sandBox=this.container.querySelector("#wr-sandbox"),this.sandBox.style.width=this.width+"px",this.sandBox.style.height=this.height+"px",this.sandBoxDoc=this.sandBox.contentDocument,this.sandBoxDoc.open(),this.sandBoxDoc.write("<!DOCTYPE html>"),this.sandBoxDoc.write("<html>"),this.sandBoxDoc.write("<head></head>"),this.sandBoxDoc.write("<body></body>"),this.sandBoxDoc.write("</html>"),this.sandBoxDoc.close(),this.setViewState()}setViewState(){const t=de(this.vNode);if(t){const e=t.firstChild;e&&e.insertBefore(this.createStyle('input[type="checkbox"] {\n    pointer-events: none;\n}\n\n\nform {\n    margin-block-end: auto;\n}\n\nhtml {\n    overflow-y: scroll;\n}\n'),e.firstChild);const n=this.sandBoxDoc.documentElement;n.replaceChild(t.firstChild,n.firstChild),n.replaceChild(t.lastChild,n.lastChild)}}initTemplate(){document.head.appendChild(this.createStyle("body {\n    margin: 0;\n}\n\n#wr-sandbox {\n    background: white;\n    vertical-align: top;\n    border: 0;\n}\n\n#wr-player {\n    position: relative;\n}\n\n#wr-pointer {\n    width: 10px;\n    height: 10px;\n    position: absolute;\n    transition: all .2s\n}\n\n#wr-pointer[active] svg {\n    fill: red;\n    transform: scale3d(1.2, 1.2, 1.2);\n}\n\n.wr-container {\n    background: grey;\n}\n\n.wr-panel {\n    width: 100%;\n    box-sizing: border-box;\n    padding: 10px;\n    height: 40px;\n    position: absolute;\n    left: 0;\n    bottom: 0;\n    background: darkgray;\n    opacity: 0.9;\n    display: flex;\n}\n\n.wr-keyboard {\n    white-space: nowrap;\n}\n\n.wr-progress {\n    width: 100%;\n    height: 20px;\n    overflow: hidden;\n\n}\n\n.wr-slider-bar {\n    position: relative;\n    padding: 0 5px;\n    width: calc(100% - 22px);\n    height: 5px;\n    margin: 7.5px 5px;\n    background: white;\n    border-radius: 2.5px;\n}\n\n.wr-thumb {\n    width: 12px;\n    height: 12px;\n    box-sizing: border-box;\n    border: 1px solid white;\n    background: black;\n    border-radius: 100%;\n    cursor: pointer;\n    position: absolute;\n    left: 0%;\n    transform: translate3d(-5px, -4px, 0);\n    z-index: 10;\n    transition: left .25s linear;\n}\n\n.wr-timer {\n    margin: 0 8px;\n    color: white;\n    font-size: 12px;\n    line-height: 20px;\n    font-family: Helvetica;\n    vertical-align: middle;\n}\n\n.wr-export button {\n    margin-left: 8px;\n}\n\n.wr-export img {\n    height: 13px;\n    vertical-align: bottom;\n}\n")),document.body.appendChild(this.createContainer())}createContainer(){const t=(new DOMParser).parseFromString('<div>\n    <div class="wr-container">\n        <div id="wr-player">\n            <iframe src="about:" id="wr-sandbox" sandbox="allow-same-origin allow-scripts"></iframe>\n        </div>\n        <div class="wr-panel">\n            <div class="wr-keyboard">\n                <button type="button" class="pause" style="letter-spacing: 1px;font-weight: bold;" speed="0">II</button>\n                <button type="button" class="play" speed="1" disabled>â–¶</button>\n                <button type="button" class="speed" disabled speed="1">1x</button>\n                <button type="button" class="speed" speed="4">4x</button>\n                <button type="button" class="speed" speed="8">8x</button>\n            </div>\n            <div class="wr-timer">\n                <time>\n                    00:00\n                </time>\n            </div>\n            <div class="wr-progress">\n                <div class="wr-slider-bar">\n                    <div class="wr-thumb"></div>\n                </div>\n            </div>\n            <div class="wr-export">\n                <button type="button">\n                    <img\n                        src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAAY0lEQVRIiWNgGOqAkQS1/8nRy0SCBWSBUQtGLRjiFpQzQDIXDKMDZLl6ch2Abgk2TLbhxFhCseH4LKGa4dgsIdpwZhIsOMoAKUEPMjAwNJLktFGADyDXStgyE8Vm07yoGPoAAH1UItbw1O5lAAAAAElFTkSuQmCC" />\n                </button>\n            </div>\n        </div>\n        <div id="wr-pointer">\n            <svg fill="#000000" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 26 26" width="16px" height="16px">\n                <path\n                    d="M 7 2.015625 L 20.160156 14.34375 L 14.785156 14.828125 L 13.808594 14.917969 L 14.214844 15.8125 L 17.476563 22.957031 L 15.070313 24.015625 L 11.957031 16.792969 L 11.566406 15.882813 L 10.84375 16.5625 L 7.027344 20.144531 L 7 2.015625 M 7 0.015625 C 6.730469 0.015625 6.460938 0.0664063 6.203125 0.179688 C 5.472656 0.496094 5 1.21875 5 2.015625 L 5.027344 20.144531 C 5.027344 20.941406 5.503906 21.660156 6.230469 21.976563 C 6.488281 22.085938 6.757813 22.140625 7.023438 22.140625 C 7.523438 22.140625 8.015625 21.953125 8.394531 21.601563 L 10.855469 19.289063 L 13.234375 24.804688 C 13.445313 25.296875 13.84375 25.679688 14.339844 25.875 C 14.574219 25.96875 14.820313 26.015625 15.070313 26.015625 C 15.34375 26.015625 15.617188 25.957031 15.875 25.84375 L 18.28125 24.785156 C 18.769531 24.570313 19.15625 24.167969 19.34375 23.667969 C 19.535156 23.167969 19.519531 22.613281 19.296875 22.125 L 16.796875 16.65625 L 20.339844 16.332031 C 21.125 16.261719 21.796875 15.738281 22.050781 14.992188 C 22.308594 14.246094 22.101563 13.421875 21.527344 12.882813 L 8.367188 0.554688 C 7.988281 0.199219 7.496094 0.015625 7 0.015625 Z" />\n            </svg>\n        </div>\n    </div>\n    \x3c!--env--\x3e\n    \x3c!-- Global site tag (gtag.js) - Google Analytics --\x3e\n    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-151180797-1"><\/script>\n    <script>\n        window.dataLayer = window.dataLayer || [];\n        function gtag() { dataLayer.push(arguments); }\n        gtag(\'js\', new Date());\n        gtag(\'config\', \'UA-151180797-1\');\n    <\/script>\n    \x3c!--env--\x3e\n</div>\n',"text/html").body.firstChild;return t.style.width=this.width+"px",t.style.height=this.height+"px",t.style.position="relative",t.style.margin="0 auto",this.container=t}createStyle(t){const e=document.createElement("style");return e.innerHTML=t,e}}class De{constructor(t){this.c=t,this.init()}init(){this.controller=this.c.container.querySelector(".wr-keyboard"),this.pauseBtn=this.controller.querySelector(".pause"),this.exportBtn=this.c.container.querySelector(".wr-export"),this.playBtn=this.controller.querySelector(".play"),this.exportBtn.addEventListener("click",this.export),this.controller.addEventListener("click",t=>{if(t.target&&"button"===t.target.type){const e=Number(t.target.getAttribute("speed"));this.speed=e,Kt.dispatch({type:i.SPEED,data:{speed:e}})}}),Kt.subscribe("player",t=>{this.paly(t.speed),this.setSpeed(t.speed)})}paly(t){0!==t?(this.pauseBtn.removeAttribute("disabled"),this.playBtn.setAttribute("disabled","")):(this.playBtn.removeAttribute("disabled"),this.pauseBtn.setAttribute("disabled",""))}setSpeed(t){const e=this.c.container.querySelectorAll(".speed");[...e].forEach(t=>{t.removeAttribute("disabled")});const n=1===t?0:4===t?1:8===t?2:-1;n>-1&&e[n].setAttribute("disabled","")}export(){ne()}}function Se(t){const{type:n,data:r}=t;switch(n){case ue.WINDOW:const{scrollLeft:t,scrollTop:n}=r;this.c.sandBoxDoc.documentElement.scrollTo(t,n);break;case ue.MOUSE:const{x:o,y:i,type:a}=r;a===he.MOVE?this.pointer.move(o,i):a===he.CLICK&&this.pointer.click(o,i);break;case ue.DOM_UPDATE:const{mutations:s}=r;s.forEach(t=>{const{mType:n,data:r}=t,{value:o,attr:i,type:a,parentId:s,pos:c,nodeId:d,vNode:u}=r;switch(n){case"attributes":const t=e.getNode(d);t&&t.setAttribute(i,o||"");break;case"characterData":const n=e.getNode(s);if(null!==c){const t=n.childNodes[c];n.replaceChild(document.createTextNode(o),t)}else n.innerText=o;break;case"childList":const l=e.getNode(s),h=e.getNode(d)||de(u);if(a===pe.DELETE)h&&l.removeChild(h);else if(pe.ADD)if("string"==typeof o){const t=document.createTextNode(o);l.childNodes.length?l.replaceChild(t,l.childNodes[c]):l.appendChild(t)}else l&&h?l.insertBefore(h,l.childNodes[c]):console.warn("insert error",r)}});break;case ue.FORM_EL_UPDATE:const{id:c,key:d,type:u,value:l}=r,h=e.getNode(c);u===le.INPUT?h.value=l:u===le.FOCUS?h.focus():u===le.BLUR?h.blur():u===le.ATTR&&(h[d]=l)}}class Le{constructor(t,e,n,r){this.speed=0,this.index=0,this.frameIndex=0,this.lastPercentage=0,this.data=t,this.c=e,this.pointer=n,this.progress=r,Kt.subscribe("player",t=>{this.progressState=Kt.getState().progress;const e=t.speed;this.speed=e,e>0?this.play():this.pause(),this.frames=this.getAccuratelyFrame()})}play(){0===this.index&&(this.progress.resetThumb(),this.c.setViewState()),cancelAnimationFrame(this.requestID),this.requestID=requestAnimationFrame(function e(){const n=Qt()-t;if(this.frameIndex>0&&!this.frames[this.frameIndex])return void this.stop();this.startTime||(this.startTime=Number(this.frames[this.frameIndex]));const r=this.startTime+n*this.speed,o=Number(this.frames[this.frameIndex]);r>=o&&this.renderEachFrame(r);this.requestID=requestAnimationFrame(e.bind(this))}.bind(this));const t=Qt();this.startTime=0}renderEachFrame(t){const{startTime:e}=this.progressState;this.progress.updateTimer((t-e)/1e3);const n=this.frameIndex/(this.frames.length-1)*100;for(this.progress.updateProgress(n);+this.data[this.index].time<=this.frames[this.frameIndex]&&(this.execFrame.call(this,this.data[this.index]),this.index++,this.index!==this.data.length););this.frameIndex++}pause(){cancelAnimationFrame(this.requestID),Kt.dispatch({type:i.SPEED,data:{speed:0}})}stop(){this.speed=0,this.index=0,this.frameIndex=0,this.lastPercentage=0,this.pause()}execFrame(t){Se.call(this,t)}getPercentInterval(){return.08*this.speed+.2}getAccuratelyFrame(t=250){this.progressState=Kt.getState().progress;const{startTime:e,endTime:n}=this.progressState,r=+n,o=[];for(let n=+e;n<r;n+=t)o.push(n);return o.push(r),o}}class Ie{constructor(){this.x=0,this.y=0,this.initPointer()}initPointer(){this.pointer=document.getElementById("wr-pointer"),this.move(0,0)}move(t,e){this.x=t,this.y=e,this.pointer.style.left=this.x+"px",this.pointer.style.top=this.y+"px"}click(t,e){this.move(t,e),this.pointer.setAttribute("active",""),setTimeout(()=>{this.pointer.removeAttribute("active")},20)}}class Me{constructor(t){this.totalDistance=0,this.throttleTimer=Oe(t=>{this.setThumb(t)},250,{trailing:!0}),this.progress=t.container.querySelector(".wr-progress"),this.timer=t.container.querySelector(".wr-timer"),this.thumb=this.progress.querySelector(".wr-thumb"),this.slider=this.progress.querySelector(".wr-slider-bar")}updateProgress(t){this.throttleTimer(t)}updateTimer(t){const e=function(t){t<=0&&(t=0);const[e,n,r]=[Math.floor(t/3600),Math.floor(t/60%60),Math.floor(t%60)];return[e,n,r].map(t=>t<=9?"0"+t:t).join(":").replace(/^00\:/,"")}(t);e&&(this.timer.innerHTML=e)}setThumb(t){this.thumb.style.left=t+"%"}resetThumb(){const t=this.thumb.cloneNode(!0);this.thumb.parentNode.replaceChild(t,this.thumb),t.style.left="0%",this.thumb=t}}class Ce{constructor(t,e){this.container=t,this.data=e,this.initComponent()}initComponent(){this.keyboard=new De(this.container),this.progress=new Me(this.container),this.pointer=new Ie,this.player=new Le(this.data,this.container,this.pointer,this.progress)}}async function Pe(){const t=await r,{width:e,height:n,vNode:o,data:a}=window.__ReplayData__||await t.getData(),c=new Te({vNode:o,width:e,height:n});a.length&&(new Ce(c,a),Kt.dispatch({type:s.INFO,data:{frame:0,curTime:a[0].time,startTime:a[0].time,endTime:a[a.length-1].time,length:a.length}}),setTimeout(()=>{Kt.dispatch({type:i.SPEED,data:{speed:1}})},500))}export{r as DB,ne as exportReplay,Ne as record,Pe as replay};
//# sourceMappingURL=replay.esm.js.map
